version: 2

jobs:
  big_integer:
    docker:
      - image: circleci/openjdk:8-jdk
    steps:
      - checkout
      - restore_cache:
          keys:
          - gradle-{{ checksum "~/project/BigInteger/build.gradle" }}
          - gradle-
      - run:
          name: BigInteger Test
          working_directory: ~/project/BigInteger
          command: gradle test
      - store_artifacts:
          path: ~/project/BigInteger/build/reports/tests/test
          destination: test
      - save_cache:
          key: gradle-{{ checksum "~/project/BigInteger/build.gradle" }}
          paths:
            - ~/project/.gradle

  movie_database:
    docker:
      - image: circleci/openjdk:8-jdk
    steps:
      - checkout
      - restore_cache:
          keys:
          - gradle-{{ checksum "~/project/MovieDatabase/build.gradle" }}
          - gradle-
      - run:
          name: MovieDatabase Test
          working_directory: ~/project/MovieDatabase
          command: gradle test
      - store_artifacts:
          path: ~/project/MovieDatabase/build/reports/tests/test
          destination: test
      - save_cache:
          key: gradle-{{ checksum "~/project/MovieDatabase/build.gradle" }}
          paths:
            - ~/project/.gradle

  stack_calculator:
    docker:
      - image: circleci/openjdk:8-jdk
    steps:
      - checkout
      - restore_cache:
          keys:
          - gradle-{{ checksum "~/project/StackCalculator/build.gradle" }}
          - gradle-
      - run:
          name: StackCalculator Test
          working_directory: ~/project/StackCalculator
          command: gradle test
      - store_artifacts:
          path: ~/project/StackCalculator/build/reports/tests/test
          destination: test
      - save_cache:
          key: gradle-{{ checksum "~/project/StackCalculator/build.gradle" }}
          paths:
            - ~/project/.gradle

  matching:
    docker:
      - image: circleci/openjdk:8-jdk
    steps:
      - checkout
      - restore_cache:
          keys:
          - gradle-{{ checksum "~/project/Matching/build.gradle" }}
          - gradle-
      - run:
          name: Matching Test
          working_directory: ~/project/Matching
          command: gradle test
      - store_artifacts:
          path: ~/project/Matching/build/reports/tests/test
          destination: test
      - save_cache:
          key: gradle-{{ checksum "~/project/Matching/build.gradle" }}
          paths:
            - ~/project/.gradle

workflows:
  version: 2
  test_all:
    jobs:
      - big_integer
      - movie_database
      - stack_calculator
      - matching
